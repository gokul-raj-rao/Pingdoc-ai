{% extends 'admin/base.html' %}

{% block content %}
{% load static %}

<main id="main" class="main">

    <div class="pagetitle">
      <h1>PingDocChat</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item">Chat</li>
          
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section">
        <div class="row">
          <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                    <h5 class="card-title">PingDoc Chatbot</h5>
                    <p>Modals have three optional sizes, available via modifier classes to be placed on a <code>.modal-dialog</code>. These sizes kick in at certain breakpoints to avoid horizontal scrollbars on narrower viewports..</p>
                    
                    <form class="col-md-10">
                        {% comment %} <fieldset class="row mb-3">
                            <legend class="col-form-label col-sm-2 pt-0">Select Type</legend>
                            <div class="col-sm-10">
                                <div class="form-check">
                                <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios1" value="option1" checked>
                                <label class="form-check-label" for="gridRadios1">
                                    By upload PDF
                                </label>
                                </div>
                                <div class="form-check">
                                <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios2" value="option2">
                                <label class="form-check-label" for="gridRadios2">
                                    By Enter URL
                                </label>
                                </div>
                                
                            </div>
                        </fieldset> {% endcomment %}
                        <div class="row mb-3">
                            <label for="inputText" class="col-sm-2 col-form-label">Enter URL</label>
                            <div class="col-sm-10">
                                <input type="text" name="url" class="form-control">
                                <button type="submit" name="process_url" class="btn btn-danger"><i class="bi bi-exclamation-octagon"></i>Upload</button>
                            </div>
                        </div>
                        <h5><span class="badge bg-warning">OR</span></h5>
                        <div class="row mb-3">
                            <label for="inputNumber" class="col-sm-2 col-form-label">File Upload</label>
                            <div class="col-sm-10">
                            <input class="form-control" type="file" name="pdf_file" id="formFile">
                            <button type="submit" name="upload_pdf" class="btn btn-danger"><i class="bi bi-exclamation-octagon"></i>Upload</button>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-sm-10">
                            <button type="submit" name="create_vectorstore" class="btn btn-primary">Create Vector store</button>
                            </div>
                        </div>
        
                    </form>
                    <div class="container mt-5">
                        <div class="row justify-content-center">
                            <div class="col-md-10">
                                <div class="card shadow">
                                    <div class="card-header bg-primary text-white">
                                        <h4 class="mb-0">Chatbot</h4>
                                    </div>
                                    <div class="card-body" id="chat-box" style="height: 400px; overflow-y: auto;">
                                        <!-- Chat messages will appear here -->
                                    </div>
                                    <div class="card-footer">
                                        <div class="input-group">
                                            
                                            <input 
                                                type="text" 
                                                id="user-input" 
                                                class="form-control" 
                                                placeholder="Type your message..." 
                                                autocomplete="off">
                                            <button id="send-button" class="btn btn-primary">Send</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bootstrap JS Bundle -->
                    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

                    <script>
                        $(document).ready(function () {
                            $("#send-button").click(function () {
                                const userMessage = $("#user-input").val().trim();
                                if (userMessage) {
                                    // Append user message to chat
                                    $("#chat-box").append(`
                                        <div class="d-flex justify-content-end mb-3">
                                            <div class="bg-primary text-white p-2 rounded">
                                                <strong>User:</strong> ${userMessage}
                                            </div>
                                        </div>
                                    `);
                                    $("#user-input").val("");

                                    // Send AJAX request to server
                                    $.ajax({
                                        url: "",
                                        method: "POST",
                                        data: {
                                            user_message: userMessage,
                                            csrfmiddlewaretoken: "{{ csrf_token }}"
                                        },
                                        success: function (response) {
                                            const aiResponse = response.ai_response;
                                            $("#chat-box").append(`
                                                <div class="d-flex justify-content-start mb-3">
                                                    <div class="bg-light text-dark p-2 rounded">
                                                        <strong>AI:</strong> ${aiResponse}
                                                    </div>
                                                </div>
                                            `);
                                            // Scroll chat to the bottom
                                            $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);
                                        },
                                        error: function () {
                                            alert("An error occurred. Please try again.");
                                        }
                                    });
                                }
                            });

                            // Send message on pressing Enter
                            $("#user-input").keypress(function (e) {
                                if (e.which === 13) {
                                    $("#send-button").click();
                                }
                            });
                        });
                    </script> 
                                
                    </div>
                </div>
            </div>
        </div>
    </section>


</main><!-- End #main -->

 


{% comment %} <div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">Chatbot</h4>
                </div>
                <div class="card-body" id="chat-box" style="height: 400px; overflow-y: auto;">
                    <!-- Chat messages will appear here -->
                </div>
                <div class="card-footer">
                    <div class="input-group">
                        <input 
                            type="text" 
                            id="user-input" 
                            class="form-control" 
                            placeholder="Type your message..." 
                            autocomplete="off">
                        <button id="send-button" class="btn btn-primary">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    $(document).ready(function () {
        $("#send-button").click(function () {
            const userMessage = $("#user-input").val().trim();
            if (userMessage) {
                // Append user message to chat
                $("#chat-box").append(`
                    <div class="d-flex justify-content-end mb-3">
                        <div class="bg-primary text-white p-2 rounded">
                            <strong>User:</strong> ${userMessage}
                        </div>
                    </div>
                `);
                $("#user-input").val("");

                // Send AJAX request to server
                $.ajax({
                    url: "",
                    method: "POST",
                    data: {
                        user_message: userMessage,
                        csrfmiddlewaretoken: "{{ csrf_token }}"
                    },
                    success: function (response) {
                        const aiResponse = response.ai_response;
                        $("#chat-box").append(`
                            <div class="d-flex justify-content-start mb-3">
                                <div class="bg-light text-dark p-2 rounded">
                                    <strong>AI:</strong> ${aiResponse}
                                </div>
                            </div>
                        `);
                        // Scroll chat to the bottom
                        $("#chat-box").scrollTop($("#chat-box")[0].scrollHeight);
                    },
                    error: function () {
                        alert("An error occurred. Please try again.");
                    }
                });
            }
        });

        // Send message on pressing Enter
        $("#user-input").keypress(function (e) {
            if (e.which === 13) {
                $("#send-button").click();
            }
        });
    });
</script> {% endcomment %}


{% endblock %} 